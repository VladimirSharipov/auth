<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auth Service - README</title>
    <style>
        body {
            max-width: 880px;
            margin: 0 auto;
            padding: 32px 80px;
            position: relative;
            box-sizing: border-box;
            font-family: 'Times New Roman', serif;
            line-height: 1.6;
            color: #000;
            background: #fff;
        }
        
        h1 {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 32px;
            border-bottom: 2px solid #000;
            padding-bottom: 16px;
        }
        
        h2 {
            font-size: 20px;
            font-weight: bold;
            margin-top: 32px;
            margin-bottom: 16px;
            border-bottom: 1px solid #666;
            padding-bottom: 8px;
        }
        
        h3 {
            font-size: 16px;
            font-weight: bold;
            margin-top: 24px;
            margin-bottom: 12px;
        }
        
        p {
            margin-bottom: 12px;
            text-align: justify;
        }
        
        ul, ol {
            margin-bottom: 16px;
            padding-left: 32px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        code {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border: 1px solid #ddd;
        }
        
        pre {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            padding: 16px;
            border: 1px solid #ddd;
            margin: 16px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        
        th, td {
            border: 1px solid #666;
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        
        .highlight {
            background-color: #ffffcc;
            padding: 2px 4px;
        }
        
        .note {
            background-color: #f0f8ff;
            border-left: 4px solid #4a90e2;
            padding: 16px;
            margin: 16px 0;
        }
        
        .warning {
            background-color: #fff8dc;
            border-left: 4px solid #f4a460;
            padding: 16px;
            margin: 16px 0;
        }
    </style>
</head>
<body>
    <h1>Auth Service - Authentication Microservice</h1>
    
    <h2>Overview</h2>
    <p>This is a robust authentication microservice built with Go that provides JWT-based authentication functionality. The service offers secure token generation, refresh capabilities, and user session management with IP-based security features.</p>
    
    <h2>Features</h2>
    <ul>
        <li>JWT Access Token Generation</li>
        <li>Refresh Token Management</li>
        <li>IP-based Security Validation</li>
        <li>PostgreSQL Database Integration</li>
        <li>Docker & Docker Compose Support</li>
        <li>Comprehensive Testing Suite</li>
        <li>Database Migration Support</li>
        <li>Structured Logging with Zerolog</li>
        <li>Graceful Server Shutdown</li>
        <li>Environment-based Configuration</li>
    </ul>
    
    <h2>Technology Stack</h2>
    <table>
        <tr>
            <th>Component</th>
            <th>Technology</th>
            <th>Version</th>
        </tr>
        <tr>
            <td>Runtime</td>
            <td>Go</td>
            <td>1.22.2</td>
        </tr>
        <tr>
            <td>Web Framework</td>
            <td>Chi Router</td>
            <td>v5.1.0</td>
        </tr>
        <tr>
            <td>Database</td>
            <td>PostgreSQL</td>
            <td>Latest</td>
        </tr>
        <tr>
            <td>Authentication</td>
            <td>JWT</td>
            <td>v4.5.0</td>
        </tr>
        <tr>
            <td>Logging</td>
            <td>Zerolog</td>
            <td>v1.33.0</td>
        </tr>
        <tr>
            <td>Testing</td>
            <td>Testify</td>
            <td>v1.9.0</td>
        </tr>
    </table>
    
    <h2>Project Structure</h2>
    <pre>
auth/
├── cmd/
│   └── auth/
│       └── main.go              # Application entry point
├── internal/
│   ├── database/
│   │   ├── models/              # Database models
│   │   └── pgsql/               # PostgreSQL implementation
│   ├── handlers/                # HTTP handlers
│   ├── domain/
│   │   ├── api/response/        # API response structures
│   │   ├── ip/                  # IP handling utilities
│   │   └── jwt/                 # JWT token management
├── migrations/                  # Database migrations
├── tests/                       # Test files
├── .idea/                       # IDE configuration
├── docker-compose.yml           # Docker Compose configuration
├── Dockerfile                   # Docker build configuration
├── go.mod                       # Go module dependencies
├── go.sum                       # Go module checksums
├── Makefile                     # Build and deployment commands
└── .gitignore                   # Git ignore rules
    </pre>
    
    <h2>API Endpoints</h2>
    
    <h3>Access Token Generation</h3>
    <p><strong>Endpoint:</strong> <code>GET /access</code></p>
    <p><strong>Description:</strong> Generates a new access token and refresh token pair for a user.</p>
    <p><strong>Parameters:</strong></p>
    <ul>
        <li><code>guid</code> (query parameter, required): User's unique identifier (UUID format)</li>
    </ul>
    <p><strong>Response:</strong></p>
    <pre>
{
    "access_token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "base64_encoded_refresh_token"
}
    </pre>
    
    <h3>Token Refresh</h3>
    <p><strong>Endpoint:</strong> <code>POST /refresh</code></p>
    <p><strong>Description:</strong> Refreshes an existing access token using a valid refresh token.</p>
    <p><strong>Request Body:</strong> Contains the refresh token for validation</p>
    <p><strong>Response:</strong> New access token and refresh token pair</p>
    
    <h2>Installation & Setup</h2>
    
    <h3>Prerequisites</h3>
    <ul>
        <li>Go 1.22.2 or higher</li>
        <li>PostgreSQL 12+ (or Docker)</li>
        <li>Docker & Docker Compose (optional)</li>
        <li>Make (optional, for using Makefile commands)</li>
    </ul>
    
    <h3>Environment Configuration</h3>
    <p>Create environment files for different deployment scenarios:</p>
    
    <h4>Local Development (.env)</h4>
    <pre>
# Database Configuration
DB_USER=postgres
DB_PASSWORD=mypass
DB_HOST=localhost
DB_PORT=5432
DB_NAME=auth_db

# JWT Configuration
OWN_KEY=your_secret_jwt_key_here
TOKEN_TTL=24h

# Application Configuration
APP_ENV=local
    </pre>
    
    <h4>Docker Environment (.env.docker)</h4>
    <pre>
# Database Configuration
DB_USER=postgres
DB_PASSWORD=mypass
DB_HOST=db
DB_PORT=5432
DB_NAME=db

# JWT Configuration
OWN_KEY=your_secret_jwt_key_here
TOKEN_TTL=24h

# Application Configuration
APP_ENV=docker
    </pre>
    
    <div class="note">
        <p><strong>Note:</strong> Make sure to use a strong, randomly generated secret key for the <code>OWN_KEY</code> environment variable in production environments.</p>
    </div>
    
    <h2>Deployment Options</h2>
    
    <h3>Docker Deployment (Recommended)</h3>
    <p>The easiest way to run the application is using Docker Compose:</p>
    <pre>
# Build and start all services
make docker_up

# Or manually:
docker-compose up -d

# View logs
docker-compose logs -f

# Stop services
make docker_down
    </pre>
    
    <h3>Local Development</h3>
    <p>For local development with automatic database migration and testing:</p>
    <pre>
# Run migrations, tests, and start the application
make local

# Or run individual commands:
make mig_up          # Run database migrations
make test_coverage   # Run tests with coverage
make run            # Start the application
    </pre>
    
    <h2>Database Management</h2>
    
    <h3>Migrations</h3>
    <p>The project uses database migrations to manage schema changes:</p>
    <pre>
# Apply migrations
make mig_up

# Rollback migrations
make mig_down

# Docker environment migrations are handled automatically
    </pre>
    
    <h3>Database Schema</h3>
    <p>The service uses a PostgreSQL database with the following key components:</p>
    <ul>
        <li><strong>Users Table:</strong> Stores user information including GUID, IP addresses, and hashed refresh tokens</li>
        <li><strong>Token Management:</strong> Refresh tokens are hashed and stored for security</li>
        <li><strong>IP Validation:</strong> IP addresses are tracked for additional security</li>
    </ul>
    
    <h2>Testing</h2>
    
    <h3>Local Testing</h3>
    <pre>
# Run tests with coverage report
make test_coverage

# Run tests with terminal coverage output
make test_coverage_terminal

# Run all tests
go test ./...
    </pre>
    
    <h3>Docker Testing</h3>
    <pre>
# Run tests in Docker environment
make docker_test

# Or manually:
docker-compose run app go test -v ./...
    </pre>
    
    <h2>Security Features</h2>
    
    <h3>JWT Token Security</h3>
    <ul>
        <li>Uses HS512 algorithm for token signing</li>
        <li>Configurable token TTL (Time To Live)</li>
        <li>IP-based token validation</li>
        <li>Secure token generation with proper claims</li>
    </ul>
    
    <h3>Refresh Token Security</h3>
    <ul>
        <li>Refresh tokens are hashed before storage</li>
        <li>Base64 encoding for safe transmission</li>
        <li>IP address validation on refresh</li>
        <li>Automatic token rotation on refresh</li>
    </ul>
    
    <div class="warning">
        <p><strong>Security Warning:</strong> Always use HTTPS in production environments and ensure that your JWT secret key is sufficiently random and kept secure.</p>
    </div>
    
    <h2>Monitoring & Logging</h2>
    
    <h3>Structured Logging</h3>
    <p>The application uses Zerolog for structured logging with the following features:</p>
    <ul>
        <li>JSON formatted logs for production</li>
        <li>Console formatted logs for development</li>
        <li>Request/response logging</li>
        <li>Error tracking and debugging information</li>
        <li>Performance metrics logging</li>
    </ul>
    
    <h3>Health Monitoring</h3>
    <p>The service includes:</p>
    <ul>
        <li>Graceful shutdown handling</li>
        <li>Database connection monitoring</li>
        <li>Request timeout configuration</li>
        <li>Error rate tracking</li>
    </ul>
    
    <h2>Available Make Commands</h2>
    <table>
        <tr>
            <th>Command</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><code>make run</code></td>
            <td>Run the application locally</td>
        </tr>
        <tr>
            <td><code>make local</code></td>
            <td>Full local setup: migrations + tests + run</td>
        </tr>
        <tr>
            <td><code>make docker</code></td>
            <td>Full Docker setup: build + run + test + cleanup</td>
        </tr>
        <tr>
            <td><code>make docker_up</code></td>
            <td>Start Docker Compose services</td>
        </tr>
        <tr>
            <td><code>make docker_down</code></td>
            <td>Stop Docker Compose services</td>
        </tr>
        <tr>
            <td><code>make mig_up</code></td>
            <td>Apply database migrations</td>
        </tr>
        <tr>
            <td><code>make mig_down</code></td>
            <td>Rollback database migrations</td>
        </tr>
        <tr>
            <td><code>make test_coverage</code></td>
            <td>Run tests with HTML coverage report</td>
        </tr>
        <tr>
            <td><code>make docker_test</code></td>
            <td>Run tests in Docker environment</td>
        </tr>
    </table>
    
    <h2>Contributing</h2>
    
    <h3>Development Guidelines</h3>
    <ul>
        <li>Follow Go best practices and conventions</li>
        <li>Write comprehensive tests for new features</li>
        <li>Use structured logging throughout the codebase</li>
        <li>Ensure proper error handling and validation</li>
        <li>Update documentation for API changes</li>
    </ul>
    
    <h3>Code Quality</h3>
    <ul>
        <li>Maintain test coverage above 80%</li>
        <li>Use meaningful variable and function names</li>
        <li>Follow the existing project structure</li>
        <li>Add comments for complex business logic</li>
        <li>Validate input parameters thoroughly</li>
    </ul>
    
    <h2>Troubleshooting</h2>
    
    <h3>Common Issues</h3>
    <p><strong>Database Connection Issues:</strong></p>
    <ul>
        <li>Verify database credentials in environment files</li>
        <li>Ensure PostgreSQL is running on the correct port</li>
        <li>Check network connectivity for Docker environments</li>
    </ul>
    
    <p><strong>Token Generation Errors:</strong></p>
    <ul>
        <li>Verify the OWN_KEY environment variable is set</li>
        <li>Check TOKEN_TTL format (e.g., "24h", "30m")</li>
        <li>Ensure GUID parameter is in valid UUID format</li>
    </ul>
    
    <p><strong>Docker Issues:</strong></p>
    <ul>
        <li>Run <code>docker-compose down</code> and <code>docker-compose up -d</code> to restart</li>
        <li>Check Docker logs: <code>docker-compose logs -f</code></li>
        <li>Verify port availability (5433 for database, 8080 for application)</li>
    </ul>
    
    <h2>License</h2>
    <p>This project is provided as-is for educational and development purposes. Please review and comply with any applicable licenses for the dependencies used in this project.</p>
    
    <h2>Support</h2>
    <p>For questions, issues, or contributions, please refer to the project's GitHub repository or contact the development team.</p>
</body>
</html>
